{% extends 'base.html' %}
{% load static %}

{% block title %}{{ agent.user.get_full_name }} - Real Estate Agent | Realtor{% endblock %}

{% block content %}
<div class="agent-detail-page">
    <!-- Agent Header -->
    <section class="agent-header">
        <div class="container">
            <div class="agent-header-content">
                <div class="agent-avatar-large">
                    {% if agent.user.avatar %}
                        <img src="{{ agent.user.avatar.url }}" alt="{{ agent.user.get_full_name }}">
                    {% else %}
                        <div class="avatar-placeholder-large">{{ agent.user.first_name|first }}{{ agent.user.last_name|first }}</div>
                    {% endif %}
                </div>
                
                <div class="agent-info">
                    <h1 class="agent-name">{{ agent.user.get_full_name }}</h1>
                    <div class="agent-title">Real Estate Agent at {{ agent.agency.name }}</div>
                    <div class="agent-license">License #{{ agent.license_number }}</div>
                    
                    <div class="agent-rating">
                        <div class="stars">
                            {% for i in "12345" %}
                                <i class="icon-star {% if agent.avg_rating >= forloop.counter %}filled{% endif %}"></i>
                            {% endfor %}
                        </div>
                        <span class="rating-text">{{ agent.avg_rating|floatformat:1 }} ({{ agent.review_count }} reviews)</span>
                    </div>
                    
                    <div class="agent-contact-info">
                        {% if agent.mobile_phone %}
                            <a href="tel:{{ agent.mobile_phone }}" class="contact-item">
                                <i class="icon-phone"></i>
                                {{ agent.mobile_phone }}
                            </a>
                        {% endif %}
                        <a href="mailto:{{ agent.user.email }}" class="contact-item">
                            <i class="icon-email"></i>
                            {{ agent.user.email }}
                        </a>
                        {% if agent.user.website %}
                            <a href="{{ agent.user.website }}" class="contact-item" target="_blank">
                                <i class="icon-globe"></i>
                                Website
                            </a>
                        {% endif %}
                    </div>
                </div>
                
                <div class="agent-stats-summary">
                    <div class="stat-item">
                        <span class="stat-number">{{ agent.years_experience }}</span>
                        <span class="stat-label">Years Experience</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">{{ agent.total_sales }}</span>
                        <span class="stat-label">Properties Sold</span>
                    </div>
                    <div class="stat-item">
                        <span class="stat-number">${{ agent.total_volume|floatformat:0 }}M</span>
                        <span class="stat-label">Sales Volume</span>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Agent Details -->
    <section class="agent-details-section">
        <div class="container">
            <div class="agent-details-grid">
                <!-- Main Content -->
                <div class="agent-main-content">
                    <!-- About -->
                    {% if agent.user.bio %}
                        <div class="agent-about-card">
                            <h2>About {{ agent.user.first_name }}</h2>
                            <div class="about-content">
                                {{ agent.user.bio|linebreaks }}
                            </div>
                        </div>
                    {% endif %}

                    <!-- Specializations -->
                    {% if agent.specializations %}
                        <div class="agent-specializations-card">
                            <h2>Specializations</h2>
                            <div class="specializations-grid">
                                {% for spec in agent.specializations %}
                                    <div class="specialization-item">
                                        <i class="icon-check"></i>
                                        <span>{{ spec }}</span>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}

                    <!-- Recent Listings -->
                    {% if recent_listings %}
                        <div class="agent-listings-card">
                            <h2>Recent Listings</h2>
                            <div class="listings-grid">
                                {% for property in recent_listings %}
                                    <div class="listing-card">
                                        <div class="listing-image">
                                            {% if property.images.first %}
                                                <img src="{{ property.images.first.image.url }}" alt="{{ property.title }}">
                                            {% else %}
                                                <img src="{% static 'images/property-placeholder.jpg' %}" alt="{{ property.title }}">
                                            {% endif %}
                                        </div>
                                        <div class="listing-content">
                                            <div class="listing-price">${{ property.price|floatformat:0 }}</div>
                                            <h4 class="listing-title">
                                                <a href="{{ property.get_absolute_url }}">{{ property.title }}</a>
                                            </h4>
                                            <div class="listing-features">
                                                <span>{{ property.bedrooms }} bed</span>
                                                <span>{{ property.bathrooms }} bath</span>
                                                <span>{{ property.square_feet|floatformat:0 }} sq ft</span>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}

                    <!-- Reviews -->
                    {% if reviews %}
                        <div class="agent-reviews-card">
                            <h2>Client Reviews</h2>
                            
                            <!-- Rating Distribution -->
                            <div class="rating-distribution">
                                {% for rating, count in rating_distribution.items %}
                                    <div class="rating-bar">
                                        <span class="rating-label">{{ rating }} star{{ rating|pluralize }}</span>
                                        <div class="rating-progress">
                                            <div class="rating-fill" style="width: {% widthratio count agent.review_count 100 %}%"></div>
                                        </div>
                                        <span class="rating-count">{{ count }}</span>
                                    </div>
                                {% endfor %}
                            </div>
                            
                            <!-- Reviews List -->
                            <div class="reviews-list">
                                {% for review in reviews %}
                                    <div class="review-item">
                                        <div class="review-header">
                                            <div class="reviewer-info">
                                                <strong>{{ review.reviewer.get_full_name|default:review.reviewer.username }}</strong>
                                                <div class="review-stars">
                                                    {% for i in "12345" %}
                                                        <i class="icon-star {% if review.rating >= forloop.counter %}filled{% endif %}"></i>
                                                    {% endfor %}
                                                </div>
                                            </div>
                                            <div class="review-date">{{ review.created_at|date:"M d, Y" }}</div>
                                        </div>
                                        <h4 class="review-title">{{ review.title }}</h4>
                                        <p class="review-comment">{{ review.comment }}</p>
                                    </div>
                                {% endfor %}
                            </div>
                        </div>
                    {% endif %}
                </div>

                <!-- Sidebar -->
                <div class="agent-sidebar">
                    <!-- Contact Card -->
                    <div class="contact-card">
                        <h3>Contact {{ agent.user.first_name }}</h3>
                        <form class="contact-form" hx-post="{% url 'agents:submit_review' agent.id %}" hx-target="#contact-result">
                            <div class="form-group">
                                <input type="text" name="name" placeholder="Your Name" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <input type="email" name="email" placeholder="Your Email" class="form-control" required>
                            </div>
                            <div class="form-group">
                                <input type="tel" name="phone" placeholder="Your Phone" class="form-control">
                            </div>
                            <div class="form-group">
                                <textarea name="message" placeholder="Your Message" class="form-control" rows="4" required></textarea>
                            </div>
                            <button type="submit" class="btn btn-primary btn-block">Send Message</button>
                        </form>
                        <div id="contact-result"></div>
                    </div>

                    <!-- Agency Info -->
                    <div class="agency-card">
                        <h3>Agency Information</h3>
                        {% if agent.agency.logo %}
                            <img src="{{ agent.agency.logo.url }}" alt="{{ agent.agency.name }}" class="agency-logo">
                        {% endif %}
                        <h4>{{ agent.agency.name }}</h4>
                        <div class="agency-contact">
                            <p><i class="icon-phone"></i> {{ agent.agency.phone }}</p>
                            <p><i class="icon-email"></i> {{ agent.agency.email }}</p>
                            {% if agent.agency.website %}
                                <p><i class="icon-globe"></i> <a href="{{ agent.agency.website }}" target="_blank">Website</a></p>
                            {% endif %}
                        </div>
                        <a href="{{ agent.agency.get_absolute_url }}" class="btn btn-outline btn-block">View Agency</a>
                    </div>

                    <!-- Professional Details -->
                    <div class="professional-card">
                        <h3>Professional Details</h3>
                        <div class="details-list">
                            <div class="detail-item">
                                <span class="detail-label">License Number</span>
                                <span class="detail-value">{{ agent.license_number }}</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Years Experience</span>
                                <span class="detail-value">{{ agent.years_experience }}</span>
                            </div>
                            {% if agent.languages %}
                                <div class="detail-item">
                                    <span class="detail-label">Languages</span>
                                    <span class="detail-value">{{ agent.languages|join:", " }}</span>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/agents.css' %}">
{% endblock %}
